// Adafruit IO Digital Output Example
// Tutorial Link: https://learn.adafruit.com/adafruit-io-basics-digital-output
//
// Adafruit invests time and resources providing this open source code.
// Please support Adafruit and open source hardware by purchasing
// products from Adafruit!
//
// Written by Todd Treece for Adafruit Industries
// Copyright (c) 2016 Adafruit Industries
// Licensed under the MIT license.
//
// All text above must be included in any redistribution.

/************************** Configuration ***********************************/

// edit the config.h tab and enter your Adafruit IO credentials
// and any additional configuration needed for WiFi, cellular,
// or ethernet clients.
#include "config.h"

/************************** NEOPIXEL STUFF ***********************************/

#include <Adafruit_NeoPixel.h>
#ifdef __AVR__
#include <avr/power.h> // Required for 16 MHz Adafruit Trinket
#endif

// Which pin on the Arduino is connected to the NeoPixels?
#define LED_PIN    14

// How many NeoPixels are attached to the Arduino?
#define LED_COUNT 24

// Declare our NeoPixel strip object:
Adafruit_NeoPixel strip(LED_COUNT, LED_PIN, NEO_GRBW + NEO_KHZ800);

/************************ Example Starts Here *******************************/

// digital pin 5
#define LED_PIN1 2
#define LED_PIN2 4
#define LED_PIN3 5

// set up the 'digital' feed
AdafruitIO_Feed *digital = io.feed("digital");

int reading;

void setup() {
  
  pinMode(LED_PIN1, OUTPUT);
  pinMode(LED_PIN2, OUTPUT);  
  pinMode(LED_PIN3, OUTPUT);

  // start the serial connection
  Serial.begin(115200);

  // wait for serial monitor to open
  while(! Serial);

  // connect to io.adafruit.com
  Serial.print("Connecting to Adafruit IO");
  io.connect();

  // set up a message handler for the 'digital' feed.
  // the handleMessage function (defined below)
  // will be called whenever a message is
  // received from adafruit io.
  digital->onMessage(handleMessage);

  // wait for a connection
  while(io.status() < AIO_CONNECTED) {
    Serial.print(".");
    delay(500);
  }

  // we are connected
  Serial.println();
  Serial.println(io.statusText());
  digital->get();

/************************** NEOPIXEL STUFF START ***********************************/
  // These lines are specifically to support the Adafruit Trinket 5V 16 MHz.
  // Any other board, you can remove this part (but no harm leaving it):
#if defined(__AVR_ATtiny85__) && (F_CPU == 16000000)
  clock_prescale_set(clock_div_1);
#endif
  // END of Trinket-specific code.

  strip.begin();           // INITIALIZE NeoPixel strip object (REQUIRED)
  strip.show();            // Turn OFF all pixels ASAP
  strip.setBrightness(50); // Set BRIGHTNESS to about 1/5 (max = 255)


/************************** NEOPIXEL STUFF END ***********************************/


}

void loop() {

  // io.run(); is required for all sketches.
  // it should always be present at the top of your loop
  // function. it keeps the client connected to
  // io.adafruit.com, and processes any incoming data.
  io.run();

}

// this function is called whenever an 'digital' feed message
// is received from Adafruit IO. it was attached to
// the 'digital' feed in the setup() function above.
void handleMessage(AdafruitIO_Data *data) {
  reading = data->toInt();
  Serial.println(reading);


  if(reading == 1) {
    Serial.println("SPIN");
    digitalWrite(LED_PIN1, HIGH);
    WheelBlue(strip.Color(0, 0, 255), 100); // Blue, 100% brightness
  
  }
   else
    digitalWrite(LED_PIN1, LOW);
  
  
  if(reading == 2) {
    Serial.println("SPARKLE");
    digitalWrite(LED_PIN2, HIGH);
    SparkleBlue(strip.Color(0, 0, 255), 100); // Blue, 100% brightness

   }
    else
    digitalWrite(LED_PIN2, LOW);


  if(reading == 3) {
    Serial.println("PULSE");
    digitalWrite(LED_PIN3, HIGH);
    PulseBlue(strip.Color(0, 0, 255), 100); // Blue, 100% brightness

  }
  else
    digitalWrite(LED_PIN3, LOW);


}



/////////////////END/////////////////////

void SparkleBlue(uint32_t color, int wait) {
  
  for(int a=0; a<10; a++) {  // Repeat 10 times... COMMENT OUT TO CUT SHORT
      Serial.println(reading);

    for(int b=0; b<2; b++) { //  'b' counts from 0 to 2...
      strip.clear();         //   Set all pixels in RAM to 0 (off)
      // 'c' counts up from 'b' to end of strip in steps of 3...
      for(int c=b; c<strip.numPixels(); c += 2) {
        strip.setPixelColor(c, color); // Set pixel 'c' to value 'color'
      }
      strip.show(); // Update strip with new contents
      delay(150);  // Pause for a moment
      
    }
  }  

}



void WheelBlue(uint32_t color, int wait) {
  
  int start = (millis()%750) * LED_COUNT / 750; 
  for(int d=0; d<20; d++) {  // Repeat 5 times... COMMENT OUT TO CUT SHORT  // one rev per 3/4 second
    Serial.println(reading);

  for(int i = 0; i<4; i++) {
    strip.setPixelColor((i+start) % LED_COUNT, color);
  }
  for(int i = 4; i<LED_COUNT; i++) {
    strip.setPixelColor((i+start) % LED_COUNT, 0);
  }
  strip.show();

  
  
  if(reading == 2) {
    digitalWrite(LED_PIN2, HIGH);
    SparkleBlue(strip.Color(0, 0, 255), 100); // Blue, 100% brightness
   }
    else
    digitalWrite(LED_PIN2, LOW);

  if(reading == 3) {
    digitalWrite(LED_PIN3, HIGH);
    PulseBlue(strip.Color(0, 0, 255), 100); // Blue, 100% brightness
  }
  else
    digitalWrite(LED_PIN3, LOW);  
}
    loop();
}




void PulseBlue(uint32_t color, int wait) {

  for(int a=0; a<5; a++) {  // Repeat 5 times... COMMENT OUT TO CUT SHORT
    Serial.println(reading);

  for(int j=50; j<256; j++) { // Ramp up from 0 to 255
    // Fill entire strip with white at gamma-corrected brightness level 'j':
    strip.fill(strip.Color(0, 0, j, 0));
    strip.show();
    delay(5);
  }
  for(int j=255; j>=50; j--) { // Ramp down from 255 to 0
    strip.fill(strip.Color(0, 0, j, 0));
    strip.show();
    delay(5);
  }

  if(reading == 1) {
    digitalWrite(LED_PIN1, HIGH);
    WheelBlue(strip.Color(0, 0, 255), 100); // Blue, 100% brightness
  }
   else
    digitalWrite(LED_PIN1, LOW);
  
  if(reading == 2) {
    digitalWrite(LED_PIN2, HIGH);
    SparkleBlue(strip.Color(0, 0, 255), 100); // Blue, 100% brightness
   }
    else
    digitalWrite(LED_PIN2, LOW);

  
}
    loop();
}

/*

  if(reading == 1) {
    digitalWrite(LED_PIN1, HIGH);
    WheelBlue(strip.Color(0, 0, 255), 100); // Blue, 100% brightness
  }
   else
    digitalWrite(LED_PIN1, LOW);
  
  if(reading == 2) {
    digitalWrite(LED_PIN2, HIGH);
    SparkleBlue(strip.Color(0, 0, 255), 100); // Blue, 100% brightness
   }
    else
    digitalWrite(LED_PIN2, LOW);

  if(reading == 3) {
    digitalWrite(LED_PIN3, HIGH);
    PulseBlue(strip.Color(0, 0, 255), 100); // Blue, 100% brightness
  }
  else
    digitalWrite(LED_PIN3, LOW);

*/    
